<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negozio Online</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #product-list { margin-top: 20px; }
        .product-item { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Negozio Online</h1>
    <label for="marca-select">Seleziona Marca:</label>
    <select id="marca-select">
        <option value="Marca1">Marca 1</option>
        <option value="Marca2">Marca 2</option>
    </select>

    <div id="product-list"></div>

    <button id="generateReceipt" style="margin-top: 20px;">Genera Scontrino</button>

    <script>
        let carrello = [];

        // carica i prodotti per la marca selezionata
        document.getElementById('marca-select').addEventListener('change', function() {
            const marca = this.value;
            fetch(`/api/prodotti/json`)
                .then(response => response.json())
                .then(data => {
                    const filteredProducts = data.filter(product => product.marca === marca);
                    displayProducts(filteredProducts);
                });
        });

        // visualizza i prodotti
        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';

            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('product-item');
                productDiv.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>Descrizione: ${product.description}</p>
                    <p>Prezzo: €${product.price}</p>
                    <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})">Aggiungi al carrello</button>
                `;
                productList.appendChild(productDiv);
            });
        }

        // aggiungi prodotto al carrello
        function addToCart(id, name, price) {
            carrello.push({ id, name, price });
            alert(`${name} aggiunto al carrello!`);
        }

        // genera il PDF dello scontrino
        document.getElementById('generateReceipt').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text('Scontrino Fiscale', 10, 10);
            let yOffset = 20;

            carrello.forEach(product => {
                doc.text(`${product.name} - €${product.price}`, 10, yOffset);
                yOffset += 10;
            });

            const total = carrello.reduce((sum, product) => sum + product.price, 0);
            doc.text(`Totale: €${total.toFixed(2)}`, 10, yOffset + 10);

            doc.save('scontrino.pdf');
        });

        // carica i prodotti inizali
        document.getElementById('marca-select').dispatchEvent(new Event('change'));
    </script>
</body>
</html>
